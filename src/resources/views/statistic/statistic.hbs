<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<div class="row">

    {{!-- <select id="chart">
        <option value="population">Dân số</option>
        <option value="ageTower">Tháp tuổi</option>
        <option value="career">Tỉ lệ nghề nghiệp</option>
        <option value="4">Trình độ văn hóa</option>
        <option value="gender">Tỉ lệ giới tính</option>
    </select>
    <button onclick="statistic()">Thống kê</button> --}}

    <div id="myChart" class='col-sm-9 p-3 shadow mt-4 mb-4'></div>
    <div class="col-sm-3 p-3">
      <div class="toast show m-4">
        <div class="toast-header">
        </div>
        <div class="toast-body">
        </div>
        {{!-- <div class="toast-footer list-group list-group-horizontal">
          <a href="/statistic/" class="list-group-item border-success text-success" data-bs-toggle="tooltip" data-bs-placement="top" title="Thống kê"><i class="far fa-chart-bar"></i></a>
          <a href="" class="list-group-item border-primary text-primary" data-bs-toggle="tooltip" data-bs-placement="top" title="Chỉnh sửa"><i class="far fa-edit"></i></a>
          <a href="" class="list-group-item border-danger text-danger" data-toggle="modal" data-id=""
            data-target="#delete-citizen-modal" data-bs-toggle="tooltip" data-bs-placement="top" title="Xóa"><i class="fas fa-trash text-danger"></i></a>
        </div> --}}
            <select id="chart">
            <option value="population">Dân số</option>
            <option value="ageTower">Tháp tuổi</option>
            <option value="career">Tỉ lệ nghề nghiệp</option>
            <option value="4">Trình độ văn hóa</option>
            <option value="gender">Tỉ lệ giới tính</option>
        </select>
        <button onclick="statistic()">Thống kê</button>
      </div>
      {{!-- <div class="toast show">
        <div class="toast-header">
            Thống kế
        </div>
        <div class="toast-body">
            <select id="chart">
                <option value="population">Dân số</option>
                <option value="ageTower">Tháp tuổi</option>
                <option value="career">Tỉ lệ nghề nghiệp</option>
                <option value="4">Trình độ văn hóa</option>
                <option value="gender">Tỉ lệ giới tính</option>
            </select>
        </div>
        <div class="toast-footer">
            <button onclick="statistic()">Thống kê</button>
        </div> --}}
        </div>
    </div>

</div>

<script> 

      getText();

        async function getText() {
            var code = localStorage.getItem('code');
            let myObject = await fetch('/declare/progress?code=' + code);
            let data = await myObject.json();
            var rate = data.declared * 100/ (data.declared + data.declaring) 
            $('.toast-header').append("<p>Mã địa phương " + data.unit.code + '</p>');
            $('.toast-body').append('<p class="h5" style="color: #400485">' + data.unit.nameUnit + '</p>');
            $('.toast-body').append('<p>Hạn cuối: ' + data.date + '</p>')
            $('.toast-body').append('<p>Tiến độ: ' + rate + '%</p>');
            $('.toast-body').append('<p>Trạng thái: ' + data.unit.progress + '</p>');
            
            
        }

    var code = localStorage.getItem('code');
    google.charts.load('current', { 'packages': ['corechart'] });
    google.charts.setOnLoadCallback(drawPopulation);

    function statistic() {
        var chart = document.getElementById("chart").value;
        switch (chart) {
            case 'population':
                google.charts.setOnLoadCallback(drawPopulation);
                break;
            case 'ageTower':
                google.charts.setOnLoadCallback(drawAgeTower);
                break;
            case 'career':
                google.charts.setOnLoadCallback(drawCareer);
                break;
            case 'gender':
                google.charts.setOnLoadCallback(drawGender);
                break;
        }
    }

    async function drawCareer() {
        
        const path = "/statistic/" +  code  + "/career";
        fetch(path)
            .then(response => response.json())
            .then(data => {
                var career = data.career;
                var number = data.number;
                var name = data.name;
                var data = new google.visualization.DataTable();

                var dataArray = [['Career', '%'],];
                
                for (var i = 0; i < career.length; i++) {
                    subArray = [career[i], number[i]];
                    dataArray.push(subArray);
                }

                var data = google.visualization.arrayToDataTable(dataArray);

                var options = {
                    'width': 800,
                    'height': 500,
                    title: 'Tỉ lệ nghề nghiệp ' + name,
                };

                var chart = new google.visualization.PieChart(document.getElementById('myChart'));
                chart.draw(data, options);
            });          
    }
    

    function drawGender() {
        const path = "/statistic/" + code  + "/gender";
        fetch(path)
            .then(response => response.json())
            .then(data => {
                var nameUnit = data.nameUnit;
                var male = data.male;
                var female = data.female;
                var name = data.name;
                var data = new google.visualization.DataTable();

                var dataArray = [['Gender', 'Male', 'Female'],];
                
                for (var i = 0; i < nameUnit.length; i++) {
                    subArray = [nameUnit[i], male[i], female[i]];
                    dataArray.push(subArray);
                }

                var data = google.visualization.arrayToDataTable(dataArray);

                var options = {
                    'width': 800,
                    'height': 500,
                    title: 'Tỉ lệ giới tính ' + name,
                };

                var chart = new google.visualization.ColumnChart(document.getElementById('myChart'));
                chart.draw(data, options);
            });          
    }
    
    function drawPopulation() {
        const path = "/statistic/" + code  + "/population";
        fetch(path)
            .then(response => response.json())
            .then(data => {
                var nameUnit = data.nameUnit;
                var population = data.population;
                var name = data.name;
                var data = new google.visualization.DataTable();

                var dataArray = [['Population', 'Tổng dân'],];
                
                for (var i = 0; i < population.length; i++) {
                    subArray = [nameUnit[i], population[i]];
                    dataArray.push(subArray);
                }

                var data = google.visualization.arrayToDataTable(dataArray);

                var options = {
                    'width': 800,
                    'height': 500,
                    title: 'Tháp dân số ' + name,
                };

                var chart = new google.visualization.ColumnChart(document.getElementById('myChart'));
                chart.draw(data, options);
            });          
    }

    function drawAgeTower() {
        const path = "/statistic/" + code  + "/ageTower";
        fetch(path)
            .then(response => response.json())
            .then(data => {
                var male = data.male;
                var female = data.female;
                var name = data.name;
                var data = new google.visualization.DataTable();

                var dataArray = [['Age', 'Male', 'Female'],];
                
                var subArray = [];

                for (var i = 0; i < male.length - 1; i++) {
                    var x1 = 5 * i;
                    var x2 = 5 * i + 4;
                    var st = "" + x1 + "-" + x2 + "";
                    subArray = [st, male[i], -female[i]];
                    dataArray.push(subArray);
                }
                subArray = ['80+', male[male.length - 1], -female[female.length - 1]];
               
                dataArray.push(subArray);

                var data = google.visualization.arrayToDataTable(dataArray);

                var options = {
                    isStacked: true,
                    'width': 800,
                    'height': 500,
                    title: 'Tháp tuổi ' + name,
                    hAxis: {
                        format: ';'
                    },
                    vAxis: {
                        direction: -1
                    }
                };

                var chart = new google.visualization.BarChart(document.getElementById('myChart'));

                var formatter = new google.visualization.NumberFormat({
                    pattern: ';'
                });

                formatter.format(data, 2)
                chart.draw(data, options);
            });          
    }
</script>